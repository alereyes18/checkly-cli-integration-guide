# Checkly CLI Setup Guide

The repository includes:
- [Quick setup guide for the Checkly CLI](#installing-the-checkly-cli)
- [Example Playwright test in `__checks__` directory](#single-folder-with-automatic-discovery)
- [Email alert configuration](#setting-up-an-email-alert-channel)
- [Integration with CI/CD pipelines](#automating-deployment-with-cicd-pipelines)

Here's a quick overview of the repository structure:
```plaintext 
|-- __checks__              # Folder for all of your checks
|   |-- api-check.ts        # Generated by install command
|   |-- heartbeat-check.ts  # Generated by install command
|   |-- homepage.check.ts   # Browser check with alerts
|   |-- homepage.spec.ts    # Generated by install command
|-- src
|   |-- alert-channels.ts   # Alert channel configuration
|-- checkly.config.ts       # Generated by install command
|-- package.json
|-- README.md
```

Follow the guide below to understand how each part works and how to adapt it for your needs. You may copy the files into an existing project or use this repository as a starting point. 

We recommend using TypeScript, but if you prefer JavaScript, you can rename the files to `.js` and update the files accordingly.

## Installing the Checkly CLI

First, let's set up the Checkly CLI in your project:

```
npm create checkly
```
Make your selections and log in to your Checkly account. This interactive set up will:
- Install the Checkly CLI.
- Create a `checkly.config.ts` file at the root of your project.
- Create a `__checks__` directory to store your checks.
- Install dependencies.


After installing the CLI, we'll create `homepage.check.ts` and `alert-channels.ts` to set up email alerts for a Playwright test.

## Single Folder with Automatic Discovery
The `checkly.config.ts` file defines where the CLI looks for checks and Playwright tests. The recommended setup is to have all checks within a `__checks__` directory. 

You can change where the CLI looks for checks by changing the following properties in the `checkly.config.ts`:

- `checks.checkMatch` - A glob pattern to match where the CLI looks for checks.
- `browserChecks.testMatch` - A glob pattern to match where the CLI looks for Playwright tests. 

These can be arrays of strings or a single string. If you have an existing folder with Playwright checks, you can add it to the `testMatch` property.
 
## Creating New Checks

To add a new check, create a file in the `__checks__` directory. This repository contains an example API check, Heartbeat check, and Playwright test with alerts.

You can override any default settings in the `checkly.config.ts` file and configure individual checks as needed.

`homepage.spec.ts` is a Playwright test that checks if the homepage of a website is accessible. The Checkly CLI will automatically convert this test into a browser check.

See our documentation on [using constructs in the CLI](https://www.checklyhq.com/docs/cli/using-constructs/) to learn more about defining checks. See the [constructs reference](https://www.checklyhq.com/docs/cli/constructs-reference/) for a list of all available checks and alert channels.

## Moving Existing Tests to Code
If you have tests already running in your Checkly account via the web UI, here's how export them:

- Go to your [Checkly Dashboard](https://app.checklyhq.com)
- Click on the â‹® menu to the right of a check
- Select "Export to Code"
- Save the generated files in the `__checks__` directory


Your existing UI-based tests will continue to run until you're ready to switch completely to the CLI-based setup. Once you migrate existing checks, you'll need to deactivate them in your Checkly account to avoid duplicate runs. You'll also want to set up alerts for your new checks in the new file.

## Setting Up an Email Alert Channel
To set up alerts, you'll need to create a `alert-channels.ts` file in your `src` directory, or copy the one in this repository. This file will define your alert channels and when/how they should be triggered.

The process of setting up an alert is similar for checks and Playwright tests, but the configuration is slightly different. The CLI will convert Playwright tests into Browser Checks, but if you want to set up alerts for them, you'll need to create a Browser Check for it, and specify the alert channels in the configuration.

 Here's a general example of how to set up an email alert channel:
1. Create the alert channel in `alert-channels.ts`:

  ```typescript
  export const emailChannel = new EmailAlertChannel("email-channel-1", {
    address: "alerts@example.com",
    ...sendDefaults, // alert channel settings
  });
  ```
  2. Add the alert channel to your checks
```typescript
import { ApiCheck, AssertionBuilder } from "checkly/constructs";
import { emailChannel } from "../src/alert-channels";

new ApiCheck("books-api-check-1", {
  name: "Books API",
  alertChannels: ["email-channel-1"],
  // ... rest of your check configuration
});
```
#### Alerts for Existing Playwright Tests

You can set up alerts for Playwright tests using the same method as for checks:
1. Make sure you export an alert channel in `alert-channels.ts`.
2. Create a new Browser Check in the `__checks__` directory, here we're calling it `homepage.check.ts`
3. Add your alert channels to the Browser Check configuration.
4. Point the Browser Check to your Playwright test.

Here's an example of how to use a Browser Check to set up alerts for a Playwright test:
```typescript
import { BrowserCheck, Frequency } from "checkly/constructs";
import { emailChannel } from "../src/alert-channels";
// Create a Browser Check to set up alerts for Playwright tests
new BrowserCheck('browser-check-1', {
    alertChannels: [emailChannel], // add your alert channels here
    code: {
     entrypoint: "./homepage.spec.ts" // location of your Playwright test, can be relative or absolute path
    }
    // ... rest of your check configuration
  })
``` 
 

## Testing and Deploying Checks

You can use the Checkly CLI to log in and perform dry runs of your tests before deploying them to your Checkly account.
Use the following commands to log in, test, and deploy your checks.
 
|Command |Description |
| --------------------| ------------------- |
| `npx checkly login` | Sign up, or log in to an existing Checkly account. |
| `npx checkly test` | Perform a dry run of all checks in your repo to make sure the CLI recognizes them.|
| `npx checkly deploy` | Deploy all checks and resources to your Checkly account. |
|`npx checkly trigger`| Run checks from your Checkly account. Use this for checks created on the web UI.|

After deploying tests, you can view them in your [Checkly dashboard](https://app.checklyhq.com/).

For a list of all available commands and flags, see the [Checkly CLI docs](https://www.checklyhq.com/docs/cli/command-line-reference/).


 
## Automating Deployment with CI/CD Pipelines

Checkly is optimized to work with a variety of CI/CD tools and workflows. You can customize your configuration to suit your needs.

Visit our [CI/CD docs](https://www.checklyhq.com/docs/cicd/) for detailed instructions on integrating with GitHub Actions, GitLab CI, and Jenkins.

Here's a summary of the steps:

1. Set up the `CHECKLY_API_KEY` and `CHECKLY_ACCOUNT_ID` environment variables in your CI/CD tool.
2. Run your checks using `npx checkly test`
3. Deploy your checks using `npx checkly deploy`

 

## Helpful Tips and Resources
- Keep the `tags: ["mac"]` in the generated `checkly.config.ts` to differentiate checks created in the UI from those created with the CLI.
- Run `npm checkly test` to perform a dry run of your checks before deploying them.
- When moving your checks to the CLI, consider deactivating your UI-based checks rather than deleting them. This way, you'll keep all of their historical data. You can read more about how long we store results [here](https://www.checklyhq.com/docs/monitoring/how-we-store-data/#data-retention).

**Documentation**
- [Command Line Reference](https://www.checklyhq.com/docs/cli/command-line-reference/)
- [CLI Configuration Guide](https://www.checklyhq.com/docs/cli/constructs-reference/)
- [Browser Check Reference](https://www.checklyhq.com/docs/browser-checks/)
- [Alert Channels](https://www.checklyhq.com/docs/alerting/)
- [CI/CD Integration](https://www.checklyhq.com/docs/cicd/)
 
We also have a Slack community where you can ask questions and share your experiences. Join us [here](https://slack.checklyhq.com/).

Good luck with your monitoring as code journey! ðŸš€
